<?xml version="1.0"?>
<launch>


<!-- full_rs_odom.launch -->
     <group ns="rs_camera">
     <include file="$(find super_robot_package)/launch/driver_realsense.launch">
          <arg name="tf_prefix" value="rs_camera" />
          <arg name="align_depth" value="true" /> 
          <arg name="linear_accel_cov" value="0.01" />
          <arg name="unite_imu_method" value="copy" />
          <arg name="depth_fps" value="30" />
          <arg name="color_fps" value="30" />
          <arg name="enable_gyro" value="true" />
          <arg name="enable_accel" value="true" />
          <arg name="initial_reset" default="false" />
     </include>

     <node pkg="nodelet" type="nodelet" name="rgbd_sync" args="load rtabmap_sync/rgbd_sync realsense2_camera_manager" output="screen">
          <remap from="rgb/image" to="color/image_raw" />
          <remap from="depth/image" to="aligned_depth_to_color/image_raw" />
          <remap from="rgb/camera_info" to="color/camera_info" />
          <param name="approx_sync" value="false" />
     </node>
     </group>


    <arg name="camera_name" default="rs_camera" />
    <arg name="publish_tf" default="true" />

    <node pkg="rtabmap_odom" type="rgbd_odometry" name="rgbd_odometry" output="screen">
          <param name="subscribe_rgbd" type="bool" value="true" />

          <param name="frame_id" type="string" value="rs_camera_link" /> <!--base_footprint-->
          <param name="odom_frame_id" type="string" value="odom"/>

          <param name="publish_tf" type="bool" value="$(arg publish_tf)" />
          <param name="publish_null_when_lost" type="bool" value="true" />

          <param name="Reg/Force3DoF" type="bool" value="false" />
          <param name="Odom/ResetCountdown" type="string" value="1" />
          <param name="Odom/Strategy" type="string" value="1"/> <!-- 0=Frame-to-Map, 1=Frame=to=Frame -->
          <param name="OdomF2M/MaxSize" type="string" value="1000"/>
          <!-- <param name="Odom/GuessMotion" type="string" value="true"/> -->
          <param name="Vis/EstimationType" type="string" value="1"/> <!-- 0=3D->3D 1=3D->2D (PnP) -->
          <param name="Vis/MaxDepth" type="string" value="0"/>
          <param name="Vis/MinInliers" type="string" value="10"/>
          <param name="GFTT/MinDistance" type="string" value="10"/>
          <param name="GFTT/QualityLevel" type="string" value="0.00001"/>
          <param name="GFTT/QualityLevel" type="string" value="0.00001"/>

          <!-- inputs -->
          <!-- if subscribe_rgbd=false -->
          <remap from="rgb/image" to="$(arg camera_name)/color/image_raw" />
          <remap from="rgb/camera_info" to="$(arg camera_name)/color/camera_info" />
          <remap from="depth/image" to="$(arg camera_name)/aligned_depth_to_color/image_raw" />
          <!-- if subscribe_rgbd=true -->
          <remap from="rgbd_image" to="$(arg camera_name)/rgbd_image" />
          <!-- outputs -->
          <remap from="odom" to="rs_camera_link" />

    </node>



<!-- Преобразование TF: Odom → Base -->
     <node pkg="tf" type="static_transform_publisher" name="odom_to_base"
          args="0 0 0.2 0 0 0 /odom /base_footprint 100" />


<!-- tf_transforms.launch-->
     <node pkg="tf2_ros" type="static_transform_publisher"
          name="base_link_2_front_rs_d435i_camera_link"
          args="
           -0.045 0.0 0.29
          0.0 0.226893.0 0.0
          /rs_camera_link /base_footprint" />





<!-- slam_gmapping.launch-->
     <arg name="scan_input_topic" default="scan" />

     <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="screen">
          <param name="base_frame" value="base_footprint"/>
          <param name="odom_frame" value="odom"/>
          <param name="map_frame" value="map"/>
          <param name="delta" value="0.1"/>
          <param name="linearUpdate" value="0.5"/>
          <param name="angularUpdate" value="0.2"/>
          <rosparam file="$(find super_robot_package)/config/slam_gmapping.yaml" command="load"/>
          <remap from="scan" to="$(arg scan_input_topic)"/>
          <remap from="scan" to="$(arg scan_input_topic)"/>
     </node>
     
     <include file="$(find super_robot_package)/launch/X4-Pro.launch" />
<launch>

